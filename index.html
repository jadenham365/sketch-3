<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<title>Untitled</title>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://tonejs.github.io/build/Tone.js"></script>
	</head>
	<body>
    
<script>
const chordSynth = new Tone.PolySynth().toDestination()
const noteIndex = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
let scale = [];
let chordProg = [];
let bpm;
  
function chooseKey() {
  const startingNote = Math.trunc(Math.random() * 11.9999999999);
  let keyPattern = [];
  let patternCount = {1: 0, 2: 0};
  for (let i = 0; i<7; i++) {
    if (patternCount[1] === 2) {
      keyPattern.push(2);
      patternCount[2]++;
    } else if (patternCount[2] === 5){
        keyPattern.push(1);
        patternCount[1]++;
    } else {
      let number = Math.round((Math.random() + 1));
      keyPattern.push(number);
      patternCount[number]++;
    }
  }
  scale.push(noteIndex[startingNote]);
  let addIndex = startingNote
  for (i = 0; i<6; i++) {
    addIndex += keyPattern[i]
    scale.push(noteIndex[(addIndex % 12)])
  }
  console.log(scale);
}
  
function chooseChordProg() {
  let startingNotes = [];
  for (let i = 0; i<4; i++) {
    let chord = [];
    let note = Math.trunc(Math.random() * 6.9999999999);
    while (startingNotes.includes(note)) {
      note = Math.trunc(Math.random() * 6.9999999999);
    }
    startingNotes.push(note);
    chord.push(noteIndex[note] + '4');
    note += 2
    note %= 7
    chord.push(noteIndex[note] + '4');
    note += 2
    note %= 7
    chord.push(noteIndex[note] + '4');
    chordProg.push(chord);
  }
  console.log(chordProg);
}

function setup() {
  
  chooseKey();
  chooseChordProg();
  const bpm = Math.round((Math.random() * 60) + 90)
  Tone.Transport.bpm.value = bpm
  for (let i = 0; i<4; i++) {
    const chord = chordProg[i]
    const time = i * 2;
    chordSynth.triggerAttackRelease(chord, '2n', time);
  }
  
  
}

  
nn.on('load', setup);
    
</script>
		
	</body>
</html>
